define("etsy.inline-hearts-module",[],function(){var t=[],e={success:$.noop,error:$.noop},i=/lid([0-9]*)/,n="favorite",r=function(i,n){n||(n={}),this.options=$.extend({},e,n),$.inArray(i,t)>=0||(this.element_selector=i,this.element=$(i),this._initialize())};return r.prototype={_handleError:function(){},_showButtons:function(t){var e=this._getListingContainer($(t));e.addClass("show-inline-buttons")},_hideButtons:function(t){var e=this._getListingContainer($(t));e.removeClass("show-inline-buttons")},_getListingContainer:function(t){return t.closest(".listing-card, .listing")},_getListingContainerForListingID:function(t){return this.element.find("#lid"+t).parents("div.listing-card-container")},_getListingId:function(t){var e=t.closest(".listing-card").attr("id");return parseInt(e.match(i)[1])},_doHeartOrUnheart:function(t){var e=this,i=this._getListingContainer(t);if(i){var r=i.find(".button-favorite"),s=r.hasClass("button-favorite-active"),o=r.data("attributee-id");r.hasClass("inline-overlay-trigger")||(this._sendHeartOrUnheart(t,s,o),r.toggleClass("button-favorite-active"));var a,l={php_event_name:s?"remove_favorite_item":"favorite_item",source:"casanova"},u=e._getListingId(t);null!==u&&(l.listing_id=u),s||o&&(l.attributee_id=o,l.attribution_source=r.data("attribution-source")||n),a=$.extend(!0,{},l),Etsy.EventLogger.logEvent(l),a.php_event_name="favorite_item"===l.php_event_name?"list_add":"list_remove",a.list_type="favorites",Etsy.EventLogger.logEvent(a)}},_sendHeartOrUnheart:function(t,e,i){var n=this,r=t,s=r.attr("href")||r.attr("data-href"),o={unheart:e,attributee_id:i,_nnc:Etsy.csrf_nonce},a=n._getListingId(r);$(document).trigger("etsy:favorite:click",[{type:"listing",id:a},!e]),$.ajax({url:s,data:o,dataType:"json",type:"POST",success:function(i){n.options.success(i,t,e),!i.response&&i.failure_message&&alert(i.failure_message);var r=e?"etsy:favorite:remove":"etsy:favorite:add";if($(document).trigger(r,[{type:"listing",id:a},i]),i.log_events)for(var s=0;s<i.log_events.length;s++){var o=i.log_events[s];o=$.extend(o,{source:"casanova"}),Etsy.EventLogger.logEvent(o)}},error:function(i){n.options.success(i,t,e),$(document).trigger("etsy:favorite:error",[{type:"listing",id:a},!e,i])}})},_isTouchScreen:function(){return navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i)},_initialize:function(){if(!this._isTouchScreen()){var t=this;$(this.element_selector+" .listing-card").live("mouseover",function(e){e.preventDefault(),t._showButtons(e.target)}),$(this.element_selector+" .listing-card").live("mouseout",function(e){e.preventDefault(),t._hideButtons(e.target)}),$(this.element_selector+" .button-favorite").live("click",function(e){if(e.which&&1!=e.which)return!0;var i=$(e.target);return i.hasClass("button-favorite")?(i.attr("disabled","disabled"),e.target.blur(),e.preventDefault(),t._doHeartOrUnheart(i),void 0):!0})}}},$(document).ready(function(){new r("ul.listings:not(.no-inline-hearts)")}),r});