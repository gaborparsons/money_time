define("etsy.listings-feed",["jquery"],function(t){function e(t){return/ads=1/.test(window.location.search)?-1===t.indexOf("?")?t+"?ads=1":t+"&ads=1":t}function i(t,e){return _.isEmpty(D.taxonomy[t])||_.each(D.taxonomy[t],function(t){t.selected=_.isUndefined(e)&&t.isParent||t.id===e}),D.taxonomy[t]}function n(t,e,i){Etsy.EventLogger.logEvent(_.extend({php_event_name:t,vertical:i},e))}function r(t){function e(e){return t.items&&_.filter(t.items,function(t){return t.type===e})||[]}var i=_.pluck(e("listing"),"listing_id"),n=_.pluck(e("promoted_shop"),"shop"),r=_.pluck(n,"shop_id");return{listing_ids:i,promoted_shop_ids:r,page:t.page,query:t.query}}function s(e){var i=4*e.$el.height();_.extend(e,R),e.initializePositions({animation:{initial:function(){return-i},ending:function(){return 0}}}),t(window).scroll(function(){var n=t(this).scrollTop();n>=e.positions.initial+i&&(e.hasFixedPosition()||(e.enableFixedNavigation(),e.hideDropDowns())),e.hasFixedPosition()&&n<e.positions.initial-e.positions.animation.ending()&&(e.disableFixedNavigation(),e.hideDropDowns())})}var o,a,l,u,c,h,d,p,f,m,g,v,y,b,w,x,E,C,S,k,A,T,I,D={};D.init=function(e,i){if(D.taxonomy=e.formattedCategories||[],g=new D.Collection,v=new D.Collection,y=new D.Collection,b=new D.Collection,x=new Backbone.Collection,w=new D.Collection,a=new D.Header({collection:w}),C=new D.ResultsManager({apiBasePath:e.apiBasePath,query:e.query||e.rootCategory,page_count:e.page||1,limit:e.limit||e.items.length,filters:e.filters}),e.newNav)new D.NewNav({collection:x});else{var n=new D.Nav;s(n)}l=new D.Results({resultsManager:C}),E=new Backbone.Collection([{id:"all",el:"#marketplace-all",enabled:!0,active:!0},{id:"handmade",el:"#marketplace-handmade",enabled:!0,active:!1},{id:"vintage",el:"#marketplace-vintage",enabled:!0,active:!1}]),u=new D.SearchMarketplace({collection:E}),S=new Backbone.Model({selected:!1}),c=new D.SearchGiftCards({model:S}),k=new Backbone.Model({locationQuery:null,displayedLocation:null}),h=new D.SearchShopLocation({model:k}),A=new Backbone.Model({ship_to:null}),d=new D.SearchShipTo({model:A}),T=new Backbone.Model({min_price:null,max_price:null}),p=new D.PriceFilter({model:T}),I=new Backbone.Model({shop_name:null}),f=new D.SearchByShop({model:I});var r=_.isFunction(window.history.pushState),M=Etsy.Context.data.subdirCode;M&&D.Util.uriContainsLocaleSubdir(M)&&(e.root="/"+M+e.root),o=new D.Router({root:e.root,rootCategory:e.rootCategory,landingCategory:e.landingCategory||e.rootCategory,hasPushState:r}),C.results.reset(e.items,{isLastPage:e.isLastPage||!1}),Backbone.history.start({pushState:r}),i&&(m=new i("#feed-results",C.results,o)),D.Util.logFeedViewEvent(e),D.Util.initListingHoverEvents(),D.Util.initInlineHearts(),t("#feed-filters").show(),l.paginator.show(),l.paginator.find("a").live("click",function(e){e.preventDefault();var i=t(this).data("page");i&&(t("#feed-new-nav").length&&(t(window).scrollLeft(0),t(window).scrollTop(0)),o.pushState(C.query,i,C.filters,!0))})},D.HeaderItem=Backbone.View.extend({tagName:"span",template:_.template("<%= name %>"),events:{click:"select"},initialize:function(){this.model.on("remove",this.remove,this)},render:function(){var t=this.model.get("name");return t=t.replace(/[\u2122]/g,""),this.$el.html(this.template({name:t,url:o.getURLByCategoryId(this.model.id)})),this},select:function(t){t.preventDefault(),this.model.id==o.landingCategory?window.location.href="/"+o.landingCategory.replace(".","/"):o.pushState(this.model.id,1,C.getStickyFilters(),!0)}}),D.HeaderParentItem=Backbone.View.extend({tagName:"span",template:_.template('<a href="<%= url %>"><%= name %></a>'),events:{click:"select"},initialize:function(){this.model.on("remove",this.remove,this)},render:function(){var t=this.model.get("name");return t=t.replace(/[\u2122]/g,""),this.$el.html(this.template({name:t,url:o.getURLByCategoryId(this.model.id)})),this},select:function(t){t.preventDefault(),this.model.id==o.landingCategory?window.location.href="/"+o.landingCategory.replace(".","/"):o.pushState(this.model.id,1,C.getStickyFilters(),!0)}}),D.Header=Backbone.View.extend({initialize:function(){this.breadcrumb=t("#feed-breadcrumb"),this.header=t("#feed-header"),this.subheader=t("#feed_subheader"),this.collection.on("reset",this.loadItems,this)},loadItems:function(e){this.header.empty(),this.breadcrumb.empty(),this.subheader.empty(),e.each(function(i,n){if(n==e.length-1){var r=new D.HeaderItem({model:i});this.header.html(r.render().el),this.subheader.html(r.model.get("header_text"))}else{var r=new D.HeaderParentItem({model:i});this.breadcrumb.append(r.render().el),n!=e.length-2&&this.breadcrumb.append(t('<span class="slash"> / </span>'))}},this)}}),D.Nav=Backbone.View.extend({el:t("#feed-nav-wrap"),initialize:function(){this.categoriesDropDown=new D.DropDown({collection:g,el:t("#feed-categories-dropdown"),feedNav:this}),this.subcategoriesDropDown=new D.DropDown({collection:v,el:t("#feed-subcategories-dropdown"),feedNav:this}),this.subclassificationsDropDown=new D.DropDown({collection:y,el:t("#feed-subclassifications-dropdown"),feedNav:this}),this.fourthLevelDropDown=new D.DropDown({collection:b,el:t("#feed-fourth-level-dropdown"),feedNav:this}),this.categoriesDropDown.linkDropDown(this.subcategoriesDropDown),this.subcategoriesDropDown.linkDropDown(this.subclassificationsDropDown),this.subclassificationsDropDown.linkDropDown(this.fourthLevelDropDown)},hideDropDowns:function(){this.categoriesDropDown.hideTooltip(),this.subcategoriesDropDown.hideTooltip(),this.subclassificationsDropDown.hideTooltip()}}),D.SearchGiftCards=Backbone.View.extend({el:t("#gift-cards"),events:{click:"searchGiftCards"},initialize:function(){this.model.on("change:selected",this.render,this)},searchGiftCards:function(){var t=_.extend({},C.filters);this.$el.is(":checked")?t.gift_cards=1:delete t.gift_cards,o.pushState(C.query,1,t,!0)},render:function(){return this.$el.prop("checked",this.model.get("selected")),this}}),D.SearchByShop=Backbone.View.extend({el:t("#feed-search-by-shop"),events:{"click input[type=button]":"submitShopLoginName","keypress input[type=text]":"submitShopLoginName"},initialize:function(){this.input=this.$el.find("input[type=text]"),this.model.on("change:shop_name",this.updateShopName,this)},updateShopName:function(){_.isNull(this.model.get("shop_name"))||this.input.val(this.model.get("shop_name"))},submitShopLoginName:function(t){if(!t.keyCode||13==t.keyCode){var e=this.input.val(),i=_.extend({},C.filters);i.shop_name=e,o.pushState(C.query,1,i,!0)}}}),D.SearchMarketplace=Backbone.View.extend({el:t("#feed-marketplace-filter"),initialize:function(){this.collection.each(function(t){new D.SearchMarketplaceTab({model:t})}),this.collection.on("change",this.updateTabs,this)},updateTabs:function(t){t.hasChanged("active")&&t.get("active")&&this.collection.each(function(e){e.id!=t.id&&e.set("active",!1)}),t.hasChanged("enabled")&&this.$el.toggleClass("blocked",!t.get("enabled"))}}),D.SearchMarketplaceTab=Backbone.View.extend({events:{click:"searchMarketplace"},initialize:function(){this.setElement(t(this.model.get("el"))),this.model.on("change",this.render,this)},searchMarketplace:function(t){if(t.preventDefault(),this.model.get("enabled")&&!this.model.get("active")){this.model.set("active",!0);var e=_.extend({},C.filters),i=this.model.get("id");"all"==i?delete e.marketplace:e.marketplace=i,o.pushState(C.query,1,e,!0)}},render:function(){this.model.get("active")?this.$el.addClass("active"):this.$el.removeClass("active")}}),D.SearchFilter=Backbone.View.extend({events:{"click .initial-state":"activate"},initialize:function(){this.$initialState=this.$(".initial-state"),this.$activeState=this.$(".active-state"),this.$selectedState=this.$(".selected-state"),this.stateModel=new Backbone.Model({state:null}),this.stateModel.on("change:state",this.renderState,this),this.stateModel.set("state","initial")},activate:function(){this.stateModel.set("state","active")},renderState:function(){var t=this.stateModel.get("state");this.$initialState.hide(),this.$activeState.hide(),this.$selectedState.hide(),"initial"==t?this.$initialState.show():"active"==t?(this.$activeState.show(),this.$activeState.find("input[type=text]").select()):"selected"==t&&this.$selectedState.show()}}),D.SearchShopLocation=D.SearchFilter.extend({el:t("#feed-shop-location-search"),events:function(){return _.extend({},D.SearchFilter.prototype.events,{"click .active-state .filter-submit":"submitLocation","click .selected-state .filter-submit":"removeLocation"})},initialize:function(){D.SearchFilter.prototype.initialize.call(this),this.input=this.$("input[type=text]"),this.selected=this.$(".facet-value");var e=this,i={use_delay:!1,select_first:!0,prevent_enter:!0,template:t("#location-autosuggest-template").html(),should_fade:!1,max_list_size:8};Etsy.Autosuggest.shop_location={formatRequest:function(){return{search_query:this.input.val()}},chooseResult:function(t){"keydown"!=t.type&&e.submitLocation(t)}},this.input.autosuggest("/geonamessuggest_ajax.php",i,"shop_location"),this.model.on("change:locationQuery",this.updateLocation,this)},updateLocation:function(){var t=this.model.get("locationQuery"),e=this.model.get("displayedLocation");this.input.val(e),this.selected.text(e),this.selected.attr("title",this.selected.text()),t&&e?this.stateModel.set("state","selected"):this.stateModel.set("state","initial")},submitLocation:function(){var e=this.input.val(),i=this.input.val(),n=self.$("li.selected");if(n.length&&(e=n.data("geonamesid"),i=n.text()),e&&i){var r=_.extend({},C.filters);r.locationQuery=e,r.displayedLocation=i,o.pushState(C.query,1,r,!0)}else this.model.set({locationQuery:null,displayedLocation:null},{silent:!0}),this.model.trigger("change:locationQuery");var s=this.input.data("autosuggest");s&&t(s.getContainer()).empty(),this.logEvent({action:"submit",location:e})},removeLocation:function(){var t=this.model.get("locationQuery"),e=_.extend({},C.filters);delete e.locationQuery,delete e.displayedLocation,o.pushState(C.query,1,e,!0),this.logEvent({action:"remove",previousLocation:t})},logEvent:function(t){Etsy.EventLogger.logEvent(_.extend({php_event_name:"browse_filter_shop_location"},t))}}),D.PriceFilter=D.SearchFilter.extend({events:function(){return _.extend({},D.SearchFilter.prototype.events,{"click .selected-state .filter-submit":"removePrice","change .active-state select":"selectPrice","click .active-state .filter-submit":"selectPrice"})},el:t("#feed-filter-by-price"),initialize:function(){D.SearchFilter.prototype.initialize.call(this),this.$select=this.$("select"),this.$currentPrice=this.$(".facet-value"),t("#filter-by-price-tpl").length&&(this.priceTextTpl=_.template(t("#filter-by-price-tpl").html())),this.model.on("change",this.updatePrice,this)},updatePrice:function(){if(this.model.get("max_price")||this.model.get("min_price")){var t=this.getSelectedFilter();this.$currentPrice.html(this.renderCurrentPrice(t)),this.stateModel.set("state","selected")}else this.$select.get(0)&&(this.$select.get(0).selectedIndex=0),this.stateModel.set("state","initial")},getSelectedFilter:function(){var t=Etsy.Context.data.price_filters,e=null;return _(["min_price","max_price"]).each(function(i,n){var r=this.model.get(i);r&&_(t).each(function(t){return t.band[n]==r?(e=t,void 0):void 0})},this),e},renderCurrentPrice:function(t){var e;return e=t.band[0]&&t.band[1]?t.symbol+t.band[0]+" â€“ "+t.symbol+t.band[1]:t.text,this.priceTextTpl({displayPrice:e,currencyCode:t.currency})},selectPrice:function(){var e=this.$select.get(0),i=t(e.options[e.selectedIndex]),n=_.extend({},C.filters),r=!1;_(["min","max"]).each(function(t){i.attr("data-"+t)&&(n[t+"_price"]=i.attr("data-"+t),r=!0)}),r?o.pushState(C.query,1,n,!0):(this.model.set({min_price:null,max_price:null},{silent:!0}),this.model.trigger("change"))},removePrice:function(){var t=_.extend({},C.filters);delete t.min_price,delete t.max_price,o.pushState(C.query,1,t,!0)}}),D.SearchShipTo=D.SearchFilter.extend({el:t("#feed-ship-to-search"),events:function(){return _.extend({},D.SearchFilter.prototype.events,{"change .active-state select":"submitRegion","click .active-state .filter-submit":"submitRegion","click .selected-state .filter-submit":"removeRegion"})},initialize:function(){D.SearchFilter.prototype.initialize.call(this),this.dropdown=this.$("select"),this.selected=this.$(".facet-value"),this.regions_map=Etsy.Context.data.regions_map||{},this.model.on("change:ship_to",this.updateRegion,this),Etsy.Context.data.default_ship_to&&this.model.set("ship_to",Etsy.Context.data.default_ship_to)},updateRegion:function(){var t=this.model.get("ship_to");t&&"ZZ"!=t?(this.selected.text(this.regions_map[t]),this.selected.attr("title",this.selected.text()),this.stateModel.set("state","selected")):this.stateModel.set("state","initial")},submitRegion:function(){var t=this.dropdown.find(":selected").val();if("ZZ"!=t){var e=_.extend({},C.filters);e.ship_to=t,o.pushState(C.query,1,e,!0)}else this.model.set({ship_to:null},{silent:!0}),this.model.trigger("change:ship_to");this.logEvent({action:"submit",region:t})},removeRegion:function(){var t=!1,e=this.model.get("ship_to");Etsy.Context.data.default_ship_to&&(t=!0,delete Etsy.Context.data.default_ship_to);var i=_.extend({},C.filters);i.ship_to="ZZ",o.pushState(C.query,1,i,!0),this.logEvent({action:"remove",optedOut:t,previousRegion:e})},logEvent:function(t){Etsy.EventLogger.logEvent(_.extend({php_event_name:"browse_filter_ship_to"},t))}}),D.SearchKeywords=Backbone.View.extend({el:t("#feed-keyword-form"),events:{submit:"searchKeywords"},initialize:function(){var e=this.$el.find("input[name=keywords]").val();e?(C.filters.keywords=e,t("#feed-keyword-facet span").text(e),t("#feed-keyword-facet").show()):t("#feed-keyword-filter").show()},searchKeywords:function(t){t.preventDefault();var e=this.$el.find("input[name=keywords]").val();if(e){var i=_.extend({},C.filters);i.keywords=e,o.pushState(C.query,1,i,!0)}},updateKeywords:function(e){t("#feed-keyword-error-inner").hide(),t("#feed-keyword-facet span").text(e),t("#feed-keyword-filter").hide(),t("#feed-keyword-facet").show()},hideError:function(){t("#feed-keyword-error-inner").hide()}}),D.SearchKeywordsFacet=Backbone.View.extend({el:t("#feed-keyword-facet"),events:{"click .remove":"removeKeywords"},removeKeywords:function(t){t&&t.preventDefault();var e=_.extend({},C.filters);delete e.keywords,o.pushState(C.query,1,e,!0),this.clearKeywords()},clearKeywords:function(){t(".feed-keyword-input input").val(""),t("#feed-keyword-facet").hide(),t("#feed-keyword-filter").show()}});var M=Backbone.View.extend({initialize:function(){this.model.on("remove",this.remove,this)},remove:function(){this.$el.remove()}});D.PromotedShop=M.extend({initialize:function(){this.template=Etsy.template("promoted_shop_template"),M.prototype.initialize.call(this)},render:function(){return this.$el.html(this.template(this.model.attributes)),this}}),D.Listing=M.extend({className:"listing-wrap",lazyLoad:!0,initialize:function(){var t=this;this.template=Etsy.template("listing_template");var e=_.isFunction(window.history.pushState),i=_.isUndefined(Etsy.Context.data.lazy_load_enabled)||Etsy.Context.data.lazy_load_enabled;!e||i?(this.$el.appear(function(){t.$el.find("img[data-src]").lazyLoad()}),this.lazyLoad=!0):this.lazyLoad=!1,M.prototype.initialize.call(this)},render:function(){return this.$el.html(this.template({imgSrc:this.model.get("image"),imgThumbSrc:this.model.get("image_url_170"),image_wrapper_height:this.model.get("image_wrapper_height")+"px",title:this.model.get("title"),shop:this.model.get("shopname"),listingId:this.model.get("listing_id"),favorites:parseInt(this.model.get("favorites"),10)||0,price:this.model.get("price"),currency:this.model.get("currency_code"),shopUrl:this.model.get("shop_url"),listingUrl:this.model.get("listing_url"),accepts_giftcards:this.model.get("accepts_giftcards"),listing_id:this.model.get("listing_id"),lazyLoad:this.lazyLoad})),this}}),D.Results=Backbone.View.extend({el:t("#feed-results-wrap"),initialize:function(e){this.resultsManager=e.resultsManager,this.collection=this.resultsManager.results,this.spinner=t("#feed-spinner"),this.showMoreButton=t("#feed-view-more"),this.paginator=t(".page-wrapper"),this.emptyResults=t("#feed-empty-results"),this.emptyResultsTemplate=_.template(t("#empty_results_template").html()),this.emptyFilteredResultsTemplate=_.template(t("#empty_filtered_results_template").html()),this.resultsErrorTemplate=_.template(t("#results_error_template").html()),this.columnsHeight=Etsy.Context.data.listingDensityEnabled?{"feed-col1":0,"feed-col2":0,"feed-col3":0,"feed-col4":0,"feed-col5":0}:{"feed-col1":0,"feed-col2":0,"feed-col3":0,"feed-col4":0},this.collection.on("reset",this.loadItemCollection,this),this.collection.on("add",this.loadItem,this),this.collection.on("remove",this.removeItem,this)},getDataForResultsModule:function(){var t={url:null,searchText:null,searchURL:null},e=D.Util.getCategoryObjectByTaxonomyId(this.resultsManager.query);return e&&(t=_.extend(t,e),t.searchURL&&(t.searchURL=Etsy.Url.appendOrReplaceParameters(t.searchURL,{ref:"feed"})),t.url=o.getURLByCategoryId(e.id)),t},showEmptyResultsModule:function(){this.emptyResults.html(this.emptyResultsTemplate(this.getDataForResultsModule())).show()},showEmptyFilteredResultsModule:function(){this.emptyResults.html(this.emptyFilteredResultsTemplate(this.getDataForResultsModule())).show()},showResultsErrorModule:function(){this.emptyResults.html(this.resultsErrorTemplate(this.getDataForResultsModule())).show()},hideEmptyResultsModule:function(){this.emptyResults.html("").hide()},getItemForModel:function(t){switch(t.get("type")){case"listing":return new D.Listing({model:t});case"promoted_shop":return new D.PromotedShop({model:t})}return void 0},loadItem:function(e,i,n){var r=this.getMinCol(),s=this.getItemForModel(e);this.$el.find("."+r).append(s.render().el),this.columnsHeight[r]+=s.$el.height(),Etsy.Context.data.dynamicPaginationEnabled&&n.scrollPage&&n.index==(this.resultsManager.page_count-1)*this.resultsManager.limit&&t(window).scrollTop(s.$el.offset().top),n.index==i.length-1&&(n.hasNoMoreResults?this.showEmptyResultsModule():this.showMoreButton.show())},loadItemCollection:function(t,e){var i=Etsy.Context.data.dynamicPaginationEnabled&&t.length>this.resultsManager.limit,n=e.isLastPage;t.each(function(e,r){this.loadItem(e,t,{index:r,scrollPage:i,hasNoMoreResults:n})},this),this.$el.trigger("etsy.listing.loaded"),t.length||_.isEmpty(C.filters)||this.showEmptyFilteredResultsModule()},getMinCol:function(){var t,e=Number.MAX_VALUE;return _.each(this.columnsHeight,function(i,n){e>i&&(e=i,t=n)}),t},removeItem:function(){0==this.collection.length&&this.resetColumns()},resetColumns:function(){_.each(this.columnsHeight,function(t,e,i){i[e]=0})}}),D.NewNavItem=Backbone.View.extend({tagName:"li",template:_.template('<a <% if (selected) { %>class="selected"<% } %> href="<%= url %>"><%= name %></a>'),events:{click:"select"},render:function(){return this.$el.html(this.template({name:this.model.get("name"),url:o.getURLByCategoryId(this.model.id),selected:this.model.get("selected")})),this},select:function(t){t.preventDefault(),o.pushState(this.model.id,1,C.getStickyFilters(),!0)}}),D.NewNav=Backbone.View.extend({el:t("#feed-new-nav"),initialize:function(){this.collection.on("change:selected",this.select,this),this.collection.on("reset",this.load,this)},load:function(t){var e={".nav-col1":0,".nav-col2":0,".nav-col3":0,".nav-col4":0},i=_.keys(e),n=_.size(e);t.each(function(t,r){var s=i[r%n];e[s]+=1}),_.each(i,function(t){this.$el.find(t).empty()},this);var r=0;_.each(e,function(e,i){_.each(_.range(e),function(e){var e=t.at(r),n=new D.NewNavItem({model:e});this.$el.find(i).append(n.render().el),r+=1},this)},this)}}),D.DropDownItem=Backbone.View.extend({tagName:"li",events:{click:"select"},initialize:function(){this.model.on("change:selected",this.toggle,this),this.model.on("remove",this.remove,this)},render:function(){return this.$el.html(this.model.get("name")),this.model.get("selected")&&(this.$el.addClass("selected"),this.model.get("isParent")&&(this.$el.addClass("hidden"),this.$el.hide())),this},select:function(){this.model.get("selected")?this.model.trigger("refresh",this.model):this.model.set({selected:!0})},toggle:function(){this.$el.toggleClass("selected"),this.model.get("isParent")&&(this.$el.removeClass("hidden"),this.$el.show(),D.isBrowse&&this.$el.closest("ul.menu").listgrid({columnLimit:9}))}}),D.DropDown=Backbone.View.extend({initialize:function(e){var i=this,n=e.feedNav;this.selectedModel=null,this.linkedDropDown=null,this.$el.append(Etsy.template("dropdown_template")),this.selected=this.$el.find(".selected"),this.menu=this.$el.find(".menu"),this.menu_wrap=this.$el.find(".menu-wrap"),this.selected.tooltip({offset:[-56,this.menu_wrap.outerWidth()-4],position:"bottom left",relative:!Etsy.Context.data.isTablet,effect:"toggle",events:{def:"click, blur"},onBeforeShow:function(){n.hideDropDowns()},onBeforeHide:function(e){"block"==t(i.menu_wrap).css("display")&&e.preventDefault()}}),this.tooltip=this.selected.data("tooltip"),Etsy.Context.data.isTouch||(this.selected.mouseenter(function(){i.tooltip.isShown()||i.tooltip.show()}),this.menu_wrap.mouseleave(function(){i.tooltip.isShown()&&i.hideTooltip()})),this.menu_wrap.mousemove(function(e){var r=e.pageX-t(window).scrollLeft(),s=e.pageY-t(window).scrollTop(),o=n.hasFixedPosition()?0:t(window).scrollTop();r>this.offsetLeft+i.selected.width()+4&&s<this.offsetTop+i.selected.height()+16-o&&i.hideTooltip()}),this.menu_wrap.click(function(){i.hideTooltip()}),this.collection.on("reset",this.loadItems,this),this.collection.on("change:selected",this.selectItem,this),this.collection.on("refresh",this.refresh,this)},refresh:function(t){this.selectItem(t,{refresh:!0})},hideTooltip:function(){this.menu_wrap.hide(),this.tooltip.hide()},setSelectedItemText:function(t,e){this.selected.parent().toggleClass("flat-border",e),this.selected.find(".selected-text").html(t)},linkDropDown:function(t){this.linkedDropDown=t},loadItems:function(t,e){t.length?(t.each(function(t){t.get("isParent")&&t.get("selected")?(this.selectedModel=t,this.setSelectedItemText(t.get("initialDescription"),!0)):t.get("selected")&&this.selectItem(t,e);var i=new D.DropDownItem({model:t});this.menu.append(i.render().el)},this),this.$el.show(),D.isBrowse&&t.length>9?this.menu.listgrid({columnLimit:9}):this.menu.removeClass("listgrid")):(this.selectedModel=null,this.$el.hide())},selectItem:function(t,e){if(t.get("selected")){var n=t.get("page_transition"),r=!e.fromReset;n&&r?window.location.href=o.getURLByCategoryId(t.id):(this.hideTooltip(),this.linkedDropDown&&(this.linkedDropDown.clearItems(),!e.fromReset&&t.id!=o.rootCategory&&t.get("selectedDescription")&&this.linkedDropDown.collection.reset(i(t.get("id")))),e.refresh||(this.setSelectedItemText(t.get("name"),t.id==o.rootCategory||!t.get("selectedDescription")),this.selectedModel?(this.selectedModel.set({selected:!1}),this.selectedModel=t):this.selectedModel=t),r&&o.pushState(t.get("id"),null,null,!0))}},clearItems:function(){this.collection.hardReset(),this.linkedDropDown&&this.linkedDropDown.clearItems()}}),D.Collection=Backbone.Collection.extend({hardReset:function(t){this.remove(this.models),this.reset(t,{fromReset:!0})}}),D.ResultsManager=Backbone.Model.extend({initialize:function(t){this.apiBasePath=t.apiBasePath,this.hasEmptyResults=!1,this.sending=!1;var e=["keywords","marketplace","ship_to","locationQuery","displayedLocation","gift_cards","shop_name","min_price","max_price"];this.valid_filters=t.valid_filters||e,this.filters=t.filters||{},this.query=t.query,this.initialCategory=this.query,this.page_count=t.page_count,this.limit=t.limit,this.results=new Backbone.Collection},hasInitialDifferentState:function(t,e,i){return t!==this.initialCategory||e!==this.page_count||!_.isEqual(this.filters,i)},getStickyFilters:function(){return _.pick(this.filters,"gift_cards","locationQuery","displayedLocation","ship_to","max_price","min_price")},requestListings:function(i,n,r,s){if(i){this.query=i,this.page_count=0,this.hasEmptyResults=!1,this.sending=!1,C.results.remove(C.results.models),l.paginator.empty(),this.page_count=n&&n>0?n-1:this.page_count,l.showMoreButton.hide(),l.hideEmptyResultsModule();var o=t("#feed-nav-wrap");if(o.length){var a=t(window).height()-(o.offset().top+o.height()-t(window).scrollTop());a>0&&t("#feed-results-wrap").css("margin-bottom",a),o.hasClass("fixed")&&(t(window).scrollLeft(0),t(window).scrollTop(t("#feed-nav-blank").offset().top))}}if(r&&(this.filters=r),!this.sending&&!this.hasEmptyResults){var u=this;this.sending=!0,l.spinner.show();var c=this.apiBasePath+"?page="+this.page_count+"&category="+this.query+(D.isGiftIdeas?"&is_gift_ideas=1":"");this.filters&&t.each(this.filters,function(e,i){t.inArray(e,u.valid_filters)>-1&&(c=c+"&"+encodeURIComponent(e)+"="+encodeURIComponent(i))}),Etsy.Context.data.isFeedPreview&&(c+="&preview=1"),Etsy.Context.data.hasRegistryContext&&(c+="&ref=registry"),c=e(c),t.ajax({url:c,dataType:"json",error:function(t,e){l.spinner.hide(),l.showResultsErrorModule(),Etsy.Logger.error("Error response on listings feed",e)},success:function(e){C.sending=!1,C.page_count+=1,l.spinner.hide(),e.success?e.success&&C.query==e.query&&(e.title&&(document.title=e.title),_.isEmpty(e.items)?C.filters&&s?(l.paginator.hide(),l.showEmptyFilteredResultsModule()):(C.hasEmptyResults=!0,l.paginator.hide(),l.showEmptyResultsModule()):(D.Util.logFeedViewEvent(e),C.results.add(e.items,{hasNoMoreResults:e.isLastPage}),t(document.body).trigger("etsy.listing.loaded"),t("#feed-results-wrap").css("margin-bottom",0),e.paginator&&l.paginator.html(e.paginator).show())):l.showResultsErrorModule()}})}}}),D.Router=Backbone.Router.extend({initialize:function(t){this.root=t.root,this.rootCategory=t.rootCategory,this.landingCategory=t.landingCategory,this.hasPushState=t.hasPushState,this.route(this.getRoutePattern(),"reload")},getRoutePattern:function(){return new RegExp(this.root.slice(1).replace("/","\\/")+"([\\w\\-]*(?:\\/[a-z0-9]+[a-z-_][\\w\\-]*){0,3})(?:\\/([0-9]+))?(\\/?\\?.*)?")},reload:function(t,e,n){var r=this.rootCategory,s={};n&&("?"==n[0]&&(n=n.substr(1)),_.extend(s,Etsy.Url.getParameters(n)));var o=t.replace(/\//g,".")||C.initialCategory;e=e||1,this.hasPushState||t||o===r||(o=C.initialCategory.substring((r+".").length));var a=o.split(".");o!==r&&(o=r+"."+o);var l,u,c,h,d=i(o);if(4==a.length&&(h=i(r+"."+a[0]+"."+a[1]+"."+a[2],o),a.pop()),3==a.length&&(c=i(r+"."+a[0]+"."+a[1],r+"."+a[0]+"."+a[1]+"."+a[2]),!h&&d&&(h=d),a.pop()),2==a.length&&(u=i(r+"."+a[0],r+"."+a[0]+"."+a[1]),!c&&d&&(c=d),a.pop()),1==a.length&&(l=i(r,(a[0]!==r?r+".":"")+a[0]),o!=r&&!u&&d&&(u=d)),D.isTrendPage&&(l=[],u=[],c=[],h=[]),g.hardReset(l),v.hardReset(u),y.hardReset(c),b.hardReset(h),w){var p=[],f=g.where({selected:!0})[0],m=v.where({selected:!0})[0],M=y.where({selected:!0})[0],R=b.where({selected:!0})[0];if(f){if("weddings"==r){var L=g.get("weddings").toJSON();L.name=L.parental_name,p.push(L),"weddings"!==f.id&&p.push(f.toJSON())}else p.push(f.toJSON());m&&m.id!==f.id&&p.push(m.toJSON()),M&&M.id!==m.id&&p.push(M.toJSON()),R&&R.id!==M.id&&p.push(R.toJSON())}w.hardReset(p)}var N=d;if(!N){var O=o.replace(/\.[^.]+$/,"");N=i(O,o)}N&&(N=_.reject(N,function(t){return t.isParent}),x.reset(N));var P=D.Util.getCategoryObjectByTaxonomyId(o);if(P){var F=s.marketplace?s.marketplace:"all";P.marketplace&&(F=P.marketplace),E.each(function(t){t.set("enabled",!P.marketplace),t.id==F&&t.set("active",!0)})}var j=!!s.gift_cards;S.set("selected",j);var B=null,V=null;s.locationQuery&&s.displayedLocation&&(B=s.locationQuery,V=s.displayedLocation),k.set({locationQuery:B,displayedLocation:V}),this.hasPushState||this.initialized||(C.filters.ship_to&&!s.ship_to&&(s.ship_to=C.filters.ship_to),s.ship_to&&s.ship_to!==C.filters.ship_to&&delete Etsy.Context.data.default_ship_to,_(["min","max"]).each(function(t){C.filters[t+"_price"]&&!s[t+"_price"]&&(s[t+"_price"]=C.filters[t+"_price"])}));var U=_.isUndefined(s.min_price)?null:s.min_price,$=_.isUndefined(s.max_price)?null:s.max_price;T.set({min_price:U,max_price:$},{silent:!0}),T.trigger("change");var H=null;s.ship_to?H=s.ship_to:Etsy.Context.data.default_ship_to&&(H=Etsy.Context.data.default_ship_to),A.set({ship_to:H});var z="";s.shop_name&&(z=s.shop_name),I.set("shop_name",z),(this.initialized||!this.hasPushState&&C.hasInitialDifferentState(o,e,s))&&C.requestListings(o,e,s,!0),this.initialized=!0},makeRoute:function(i,n,r){var s=i.replace(/\./g,"/");if(0===i.indexOf(this.rootCategory+".")&&(s=s.substring(this.rootCategory.length+1)),n&&n>1&&(s+="/"+n),r){var o="";t.each(r,function(e,i){t.inArray(e,C.valid_filters)>-1&&(o+=""==o?"/?":"&",o+=encodeURIComponent(e)+"="+encodeURIComponent(i))}),s+=o}return Etsy.Context.data.isFeedPreview&&(s+=-1==s.indexOf("?")?"?preview=1":"&preview=1"),s=e(s),this.root+s},pushState:function(t,e,i,n){var r=this.makeRoute(t,e,i);this.navigate(r,{trigger:n})},getURLByCategoryId:function(t){var e=t.replace(/^[^.]+\./,"").replace(/\./g,"/");return"weddings"==this.rootCategory&&"weddings"==e?"/weddings":"weddings"==this.rootCategory?e.indexOf("/")<0?"/"+this.rootCategory+"/"+e:"/"+this.rootCategory+"/feed/"+e:"/"+this.rootCategory+"/"+e}}),D.Util=D.Util||{},D.Util.uriContainsLocaleSubdir=function(t){var e=/\/(\w{2,})\//i,i=e.exec(window.location.pathname);return i&&i[1]===t},D.Util.getCategoryObjectByTaxonomyId=function(t){return _.find(_.flatten(D.taxonomy),function(e){return e.id==t})},D.Util.initInlineHearts=function(){require({paths:{"etsy.inline-hearts-module":"etsy.inline-hearts-module.20140402183635"}},["etsy.inline-hearts-module"],function(t){new t("div.listing.item",{success:function(t,e,i){var n=e.closest(".listing");i?n.removeClass("favorite"):n.addClass("favorite")}})})},D.Util.initListingHoverEvents=function(){t(".listing").live("mouseenter",function(){t(this).addClass("hover")}).live("mouseleave",function(){t(this).removeClass("hover")})},D.Util.logFeedViewEvent=function(e){t(function(){D.isSubcategoryPage?n("weddings_subcategory_feed_view",r(e),"weddings"):D.isTrendPage?n("weddings_trend_feed_view",r(e),"weddings"):D.isGiftIdeas?n("registry_gift_idea_feed_view",r(e),"registry"):D.isBrowse?n("browse_feed_view",r(e),"browse"):n("feed_view",r(e),e.vertical)})};var R={initializePositions:function(t){this.positions={initial:this.$el.offset().top},_.extend(this.positions,t||{})},hasFixedPosition:function(){return this.$el.hasClass("fixed")},enableFixedNavigation:function(){this.$el.addClass("fixed"),this.positions.animation&&(this.$el.offset({top:this.positions.animation.initial()}),this.$el.animate({top:this.positions.animation.ending()},"slow"))},disableFixedNavigation:function(){this.$el.removeClass("fixed")}};return D}),define("etsy.lazyload",["jquery"],function(t){var e=function(e){e.src||t(e).attr("src",t(e).attr("data-src"))};t.fn.lazyLoad=function(){return this.each(function(){new e(this)})}}),function(){var t,e=this,i=e.Backbone,n=Array.prototype.slice,r=Array.prototype.splice;t="undefined"!=typeof exports?exports:e.Backbone={},t.VERSION="0.9.2";var s=e._;s||"undefined"==typeof require||(s=require("underscore"));var o=e.jQuery||e.Zepto||e.ender;t.setDomLibrary=function(t){o=t},t.noConflict=function(){return e.Backbone=i,this},t.emulateHTTP=!1,t.emulateJSON=!1;var a=/\s+/,l=t.Events={on:function(t,e,i){var n,r,s,o,l;if(!e)return this;for(t=t.split(a),n=this._callbacks||(this._callbacks={});r=t.shift();)l=n[r],s=l?l.tail:{},s.next=o={},s.context=i,s.callback=e,n[r]={tail:o,next:l?l.next:s};return this},off:function(t,e,i){var n,r,o,l,u,c;if(r=this._callbacks){if(!(t||e||i))return delete this._callbacks,this;for(t=t?t.split(a):s.keys(r);n=t.shift();)if(o=r[n],delete r[n],o&&(e||i))for(l=o.tail;(o=o.next)!==l;)u=o.callback,c=o.context,(e&&u!==e||i&&c!==i)&&this.on(n,u,c);return this}},trigger:function(t){var e,i,r,s,o,l,u;if(!(r=this._callbacks))return this;for(l=r.all,t=t.split(a),u=n.call(arguments,1);e=t.shift();){if(i=r[e])for(s=i.tail;(i=i.next)!==s;)i.callback.apply(i.context||this,u);
if(i=l)for(s=i.tail,o=[e].concat(u);(i=i.next)!==s;)i.callback.apply(i.context||this,o)}return this}};l.bind=l.on,l.unbind=l.off;var u=t.Model=function(t,e){var i;t||(t={}),e&&e.parse&&(t=this.parse(t)),(i=k(this,"defaults"))&&(t=s.extend({},i,t)),e&&e.collection&&(this.collection=e.collection),this.attributes={},this._escapedAttributes={},this.cid=s.uniqueId("c"),this.changed={},this._silent={},this._pending={},this.set(t,{silent:!0}),this.changed={},this._silent={},this._pending={},this._previousAttributes=s.clone(this.attributes),this.initialize.apply(this,arguments)};s.extend(u.prototype,l,{changed:null,_silent:null,_pending:null,idAttribute:"id",initialize:function(){},toJSON:function(){return s.clone(this.attributes)},get:function(t){return this.attributes[t]},escape:function(t){var e;if(e=this._escapedAttributes[t])return e;var i=this.get(t);return this._escapedAttributes[t]=s.escape(null==i?"":""+i)},has:function(t){return null!=this.get(t)},set:function(t,e,i){var n,r,o;if(s.isObject(t)||null==t?(n=t,i=e):(n={},n[t]=e),i||(i={}),!n)return this;if(n instanceof u&&(n=n.attributes),i.unset)for(r in n)n[r]=void 0;if(!this._validate(n,i))return!1;this.idAttribute in n&&(this.id=n[this.idAttribute]);var a=i.changes={},l=this.attributes,c=this._escapedAttributes,h=this._previousAttributes||{};for(r in n)o=n[r],(!s.isEqual(l[r],o)||i.unset&&s.has(l,r))&&(delete c[r],(i.silent?this._silent:a)[r]=!0),i.unset?delete l[r]:l[r]=o,s.isEqual(h[r],o)&&s.has(l,r)==s.has(h,r)?(delete this.changed[r],delete this._pending[r]):(this.changed[r]=o,i.silent||(this._pending[r]=!0));return i.silent||this.change(i),this},unset:function(t,e){return(e||(e={})).unset=!0,this.set(t,null,e)},clear:function(t){return(t||(t={})).unset=!0,this.set(s.clone(this.attributes),t)},fetch:function(e){e=e?s.clone(e):{};var i=this,n=e.success;return e.success=function(t,r,s){return i.set(i.parse(t,s),e)?(n&&n(i,t),void 0):!1},e.error=t.wrapError(e.error,i,e),(this.sync||t.sync).call(this,"read",this,e)},save:function(e,i,n){var r,o;if(s.isObject(e)||null==e?(r=e,n=i):(r={},r[e]=i),n=n?s.clone(n):{},n.wait){if(!this._validate(r,n))return!1;o=s.clone(this.attributes)}var a=s.extend({},n,{silent:!0});if(r&&!this.set(r,n.wait?a:n))return!1;var l=this,u=n.success;n.success=function(t,e,i){var o=l.parse(t,i);return n.wait&&(delete n.wait,o=s.extend(r||{},o)),l.set(o,n)?(u?u(l,t):l.trigger("sync",l,t,n),void 0):!1},n.error=t.wrapError(n.error,l,n);var c=this.isNew()?"create":"update",h=(this.sync||t.sync).call(this,c,this,n);return n.wait&&this.set(o,a),h},destroy:function(e){e=e?s.clone(e):{};var i=this,n=e.success,r=function(){i.trigger("destroy",i,i.collection,e)};if(this.isNew())return r(),!1;e.success=function(t){e.wait&&r(),n?n(i,t):i.trigger("sync",i,t,e)},e.error=t.wrapError(e.error,i,e);var o=(this.sync||t.sync).call(this,"delete",this,e);return e.wait||r(),o},url:function(){var t=k(this,"urlRoot")||k(this.collection,"url")||A();return this.isNew()?t:t+("/"==t.charAt(t.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(t){return t},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},change:function(t){t||(t={});var e=this._changing;this._changing=!0;for(var i in this._silent)this._pending[i]=!0;var n=s.extend({},t.changes,this._silent);this._silent={};for(var i in n)this.trigger("change:"+i,this,this.get(i),t);if(e)return this;for(;!s.isEmpty(this._pending);){this._pending={},this.trigger("change",this,t);for(var i in this.changed)this._pending[i]||this._silent[i]||delete this.changed[i];this._previousAttributes=s.clone(this.attributes)}return this._changing=!1,this},hasChanged:function(t){return arguments.length?s.has(this.changed,t):!s.isEmpty(this.changed)},changedAttributes:function(t){if(!t)return this.hasChanged()?s.clone(this.changed):!1;var e,i=!1,n=this._previousAttributes;for(var r in t)s.isEqual(n[r],e=t[r])||((i||(i={}))[r]=e);return i},previous:function(t){return arguments.length&&this._previousAttributes?this._previousAttributes[t]:null},previousAttributes:function(){return s.clone(this._previousAttributes)},isValid:function(){return!this.validate(this.attributes)},_validate:function(t,e){if(e.silent||!this.validate)return!0;t=s.extend({},this.attributes,t);var i=this.validate(t,e);return i?(e&&e.error?e.error(this,i,e):this.trigger("error",this,i,e),!1):!0}});var c=t.Collection=function(t,e){e||(e={}),e.model&&(this.model=e.model),e.comparator&&(this.comparator=e.comparator),this._reset(),this.initialize.apply(this,arguments),t&&this.reset(t,{silent:!0,parse:e.parse})};s.extend(c.prototype,l,{model:u,initialize:function(){},toJSON:function(t){return this.map(function(e){return e.toJSON(t)})},add:function(t,e){var i,n,o,a,l,u,c={},h={},d=[];for(e||(e={}),t=s.isArray(t)?t.slice():[t],i=0,o=t.length;o>i;i++){if(!(a=t[i]=this._prepareModel(t[i],e)))throw new Error("Can't add an invalid model to a collection");l=a.cid,u=a.id,c[l]||this._byCid[l]||null!=u&&(h[u]||this._byId[u])?d.push(i):c[l]=h[u]=a}for(i=d.length;i--;)t.splice(d[i],1);for(i=0,o=t.length;o>i;i++)(a=t[i]).on("all",this._onModelEvent,this),this._byCid[a.cid]=a,null!=a.id&&(this._byId[a.id]=a);if(this.length+=o,n=null!=e.at?e.at:this.models.length,r.apply(this.models,[n,0].concat(t)),this.comparator&&this.sort({silent:!0}),e.silent)return this;for(i=0,o=this.models.length;o>i;i++)c[(a=this.models[i]).cid]&&(e.index=i,a.trigger("add",a,this,e));return this},remove:function(t,e){var i,n,r,o;for(e||(e={}),t=s.isArray(t)?t.slice():[t],i=0,n=t.length;n>i;i++)o=this.getByCid(t[i])||this.get(t[i]),o&&(delete this._byId[o.id],delete this._byCid[o.cid],r=this.indexOf(o),this.models.splice(r,1),this.length--,e.silent||(e.index=r,o.trigger("remove",o,this,e)),this._removeReference(o));return this},push:function(t,e){return t=this._prepareModel(t,e),this.add(t,e),t},pop:function(t){var e=this.at(this.length-1);return this.remove(e,t),e},unshift:function(t,e){return t=this._prepareModel(t,e),this.add(t,s.extend({at:0},e)),t},shift:function(t){var e=this.at(0);return this.remove(e,t),e},get:function(t){return null==t?void 0:this._byId[null!=t.id?t.id:t]},getByCid:function(t){return t&&this._byCid[t.cid||t]},at:function(t){return this.models[t]},where:function(t){return s.isEmpty(t)?[]:this.filter(function(e){for(var i in t)if(t[i]!==e.get(i))return!1;return!0})},sort:function(t){if(t||(t={}),!this.comparator)throw new Error("Cannot sort a set without a comparator");var e=s.bind(this.comparator,this);return 1==this.comparator.length?this.models=this.sortBy(e):this.models.sort(e),t.silent||this.trigger("reset",this,t),this},pluck:function(t){return s.map(this.models,function(e){return e.get(t)})},reset:function(t,e){t||(t=[]),e||(e={});for(var i=0,n=this.models.length;n>i;i++)this._removeReference(this.models[i]);return this._reset(),this.add(t,s.extend({silent:!0},e)),e.silent||this.trigger("reset",this,e),this},fetch:function(e){e=e?s.clone(e):{},void 0===e.parse&&(e.parse=!0);var i=this,n=e.success;return e.success=function(t,r,s){i[e.add?"add":"reset"](i.parse(t,s),e),n&&n(i,t)},e.error=t.wrapError(e.error,i,e),(this.sync||t.sync).call(this,"read",this,e)},create:function(t,e){var i=this;if(e=e?s.clone(e):{},t=this._prepareModel(t,e),!t)return!1;e.wait||i.add(t,e);var n=e.success;return e.success=function(r,s){e.wait&&i.add(r,e),n?n(r,s):r.trigger("sync",t,s,e)},t.save(null,e),t},parse:function(t){return t},chain:function(){return s(this.models).chain()},_reset:function(){this.length=0,this.models=[],this._byId={},this._byCid={}},_prepareModel:function(t,e){if(e||(e={}),t instanceof u)t.collection||(t.collection=this);else{var i=t;e.collection=this,t=new this.model(i,e),t._validate(t.attributes,e)||(t=!1)}return t},_removeReference:function(t){this==t.collection&&delete t.collection,t.off("all",this._onModelEvent,this)},_onModelEvent:function(t,e,i,n){("add"!=t&&"remove"!=t||i==this)&&("destroy"==t&&this.remove(e,n),e&&t==="change:"+e.idAttribute&&(delete this._byId[e.previous(e.idAttribute)],this._byId[e.id]=e),this.trigger.apply(this,arguments))}});var h=["forEach","each","map","reduce","reduceRight","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","sortBy","sortedIndex","toArray","size","first","initial","rest","last","without","indexOf","shuffle","lastIndexOf","isEmpty","groupBy"];s.each(h,function(t){c.prototype[t]=function(){return s[t].apply(s,[this.models].concat(s.toArray(arguments)))}});var d=t.Router=function(t){t||(t={}),t.routes&&(this.routes=t.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},p=/:\w+/g,f=/\*\w+/g,m=/[-[\]{}()+?.,\\^$|#\s]/g;s.extend(d.prototype,l,{initialize:function(){},route:function(e,i,n){return t.history||(t.history=new g),s.isRegExp(e)||(e=this._routeToRegExp(e)),n||(n=this[i]),t.history.route(e,s.bind(function(r){var s=this._extractParameters(e,r);n&&n.apply(this,s),this.trigger.apply(this,["route:"+i].concat(s)),t.history.trigger("route",this,i,s)},this)),this},navigate:function(e,i){t.history.navigate(e,i)},_bindRoutes:function(){if(this.routes){var t=[];for(var e in this.routes)t.unshift([e,this.routes[e]]);for(var i=0,n=t.length;n>i;i++)this.route(t[i][0],t[i][1],this[t[i][1]])}},_routeToRegExp:function(t){return t=t.replace(m,"\\$&").replace(p,"([^/]+)").replace(f,"(.*?)"),new RegExp("^"+t+"$")},_extractParameters:function(t,e){return t.exec(e).slice(1)}});var g=t.History=function(){this.handlers=[],s.bindAll(this,"checkUrl")},_=/^[#\/]/,v=/msie [\w.]+/;g.started=!1,s.extend(g.prototype,l,{interval:50,getHash:function(t){var e=t?t.location:window.location,i=e.href.match(/#(.*)$/);return i?i[1]:""},getFragment:function(t,e){if(null==t)if(this._hasPushState||e){t=window.location.pathname;var i=window.location.search;i&&(t+=i)}else t=this.getHash();return t.indexOf(this.options.root)||(t=t.substr(this.options.root.length)),t.replace(_,"")},start:function(t){if(g.started)throw new Error("Backbone.history has already been started");g.started=!0,this.options=s.extend({},{root:"/"},this.options,t),this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&window.history&&window.history.pushState);var e=this.getFragment(),i=document.documentMode,n=v.exec(navigator.userAgent.toLowerCase())&&(!i||7>=i);n&&(this.iframe=o('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(e)),this._hasPushState?o(window).bind("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!n?o(window).bind("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=e;var r=window.location,a=r.pathname==this.options.root;return this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!a?(this.fragment=this.getFragment(null,!0),window.location.replace(this.options.root+"#"+this.fragment),!0):(this._wantsPushState&&this._hasPushState&&a&&r.hash&&(this.fragment=this.getHash().replace(_,""),window.history.replaceState({},document.title,r.protocol+"//"+r.host+this.options.root+this.fragment)),this.options.silent?void 0:this.loadUrl())},stop:function(){o(window).unbind("popstate",this.checkUrl).unbind("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),g.started=!1},route:function(t,e){this.handlers.unshift({route:t,callback:e})},checkUrl:function(){var t=this.getFragment();return t==this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe))),t==this.fragment?!1:(this.iframe&&this.navigate(t),this.loadUrl()||this.loadUrl(this.getHash()),void 0)},loadUrl:function(t){var e=this.fragment=this.getFragment(t),i=s.any(this.handlers,function(t){return t.route.test(e)?(t.callback(e),!0):void 0});return i},navigate:function(t,e){if(!g.started)return!1;e&&e!==!0||(e={trigger:e});var i=(t||"").replace(_,"");this.fragment!=i&&(this._hasPushState?(0!=i.indexOf(this.options.root)&&(i=this.options.root+i),this.fragment=i,window.history[e.replace?"replaceState":"pushState"]({},document.title,i)):this._wantsHashChange?(this.fragment=i,this._updateHash(window.location,i,e.replace),this.iframe&&i!=this.getFragment(this.getHash(this.iframe))&&(e.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,i,e.replace))):window.location.assign(this.options.root+t),e.trigger&&this.loadUrl(t))},_updateHash:function(t,e,i){i?t.replace(t.toString().replace(/(javascript:|#).*$/,"")+"#"+e):t.hash=e}});var y=t.View=function(t){this.cid=s.uniqueId("view"),this._configure(t||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},b=/^(\S+)\s*(.*)$/,w=["model","collection","el","id","attributes","className","tagName"];s.extend(y.prototype,l,{tagName:"div",$:function(t){return this.$el.find(t)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this},make:function(t,e,i){var n=document.createElement(t);return e&&o(n).attr(e),i&&o(n).html(i),n},setElement:function(t,e){return this.$el&&this.undelegateEvents(),this.$el=t instanceof o?t:o(t),this.el=this.$el[0],e!==!1&&this.delegateEvents(),this},delegateEvents:function(t){if(t||(t=k(this,"events"))){this.undelegateEvents();for(var e in t){var i=t[e];if(s.isFunction(i)||(i=this[t[e]]),!i)throw new Error('Method "'+t[e]+'" does not exist');var n=e.match(b),r=n[1],o=n[2];i=s.bind(i,this),r+=".delegateEvents"+this.cid,""===o?this.$el.bind(r,i):this.$el.delegate(o,r,i)}}},undelegateEvents:function(){this.$el.unbind(".delegateEvents"+this.cid)},_configure:function(t){this.options&&(t=s.extend({},this.options,t));for(var e=0,i=w.length;i>e;e++){var n=w[e];t[n]&&(this[n]=t[n])}this.options=t},_ensureElement:function(){if(this.el)this.setElement(this.el,!1);else{var t=k(this,"attributes")||{};this.id&&(t.id=this.id),this.className&&(t["class"]=this.className),this.setElement(this.make(this.tagName,t),!1)}}});var x=function(t,e){var i=S(this,t,e);return i.extend=this.extend,i};u.extend=c.extend=d.extend=y.extend=x;var E={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};t.sync=function(e,i,n){var r=E[e];n||(n={});var a={type:r,dataType:"json"};return n.url||(a.url=k(i,"url")||A()),n.data||!i||"create"!=e&&"update"!=e||(a.contentType="application/json",a.data=JSON.stringify(i.toJSON())),t.emulateJSON&&(a.contentType="application/x-www-form-urlencoded",a.data=a.data?{model:a.data}:{}),t.emulateHTTP&&("PUT"===r||"DELETE"===r)&&(t.emulateJSON&&(a.data._method=r),a.type="POST",a.beforeSend=function(t){t.setRequestHeader("X-HTTP-Method-Override",r)}),"GET"===a.type||t.emulateJSON||(a.processData=!1),o.ajax(s.extend(a,n))},t.wrapError=function(t,e,i){return function(n,r){r=n===e?r:n,t?t(e,r,i):e.trigger("error",e,r,i)}};var C=function(){},S=function(t,e,i){var n;return n=e&&e.hasOwnProperty("constructor")?e.constructor:function(){t.apply(this,arguments)},s.extend(n,t),C.prototype=t.prototype,n.prototype=new C,e&&s.extend(n.prototype,e),i&&s.extend(n,i),n.prototype.constructor=n,n.__super__=t.prototype,n},k=function(t,e){return t&&t[e]?s.isFunction(t[e])?t[e]():t[e]:null},A=function(){throw new Error('A "url" property or function must be specified')}}.call(this),window.Etsy.loader.loaded("backbone-0.9.2.20140130192954.js"),function(t){t.fn.listgrid=function(e){function i(t,e,i){t.children(".column").length<e+1&&t.append('<div class="column"></div>'),t.children(".column").eq(e).append(i)}var n=t.extend({columnLimit:10},e);return this.each(function(e,r){for(var s=t(r),o=Math.ceil(s.find("li:not(.hidden)").length/n.columnLimit),a=0;5>a;a++)s.removeClass("listgrid-"+a);s.addClass("menu").addClass("listgrid").addClass("listgrid-"+o);var l=0;s.find("li").each(function(e,r){i(s,Math.floor(l/n.columnLimit),r),t(r).hasClass("hidden")||++l})})}}(jQuery),window.Etsy.loader.loaded("jquery.listgrid.20140130192955.js"),function(t){t.fn.appear=function(e,i){var n=t.extend({data:void 0,one:!0,offset:null},i);return this.each(function(){var i=t(this);if(i.appeared=!1,!e)return i.trigger("appear",n.data),void 0;var r=t(window),s=function(){if(!i.is(":visible"))return i.appeared=!1,void 0;var t=r.scrollLeft(),e=r.scrollTop(),s=i.offset(),o=s.left,a=s.top,l=i.width(),u=i.height();n.offset&&(o+=l*n.offset,a+=u*n.offset),a+u>=e&&a<=e+r.height()&&o+l>=t&&o<=t+r.width()?i.appeared||i.trigger("appear",n.data):i.appeared=!1},o=function(){if(i.appeared=!0,n.one){r.unbind("scroll",s);var o=t.inArray(s,t.fn.appear.checks);o>=0&&t.fn.appear.checks.splice(o,1)}e.apply(this,arguments)};n.one?i.one("appear",n.data,o):i.bind("appear",n.data,o),r.scroll(s),t.fn.appear.checks.push(s),s()})},t.extend(t.fn.appear,{checks:[],timeout:null,checkAll:function(){var e=t.fn.appear.checks.length;if(e>0)for(;e--;)t.fn.appear.checks[e]()},run:function(){t.fn.appear.timeout&&clearTimeout(t.fn.appear.timeout),t.fn.appear.timeout=setTimeout(t.fn.appear.checkAll,20)}}),t.each(["append","prepend","after","before","attr","removeAttr","addClass","removeClass","toggleClass","remove","css","show","hide"],function(e,i){var n=t.fn[i];n&&(t.fn[i]=function(){var e=n.apply(this,arguments);return t.fn.appear.run(),e})})}(jQuery),window.Etsy.loader.loaded("jquery.appear.20140130192955.js"),require.config({paths:{"etsy.listings-feed":"etsy.listings-feed.20140130192955","etsy.lazyload":"etsy.lazyload.20140130192955"}}),define("bootstrap/browse/common",["jquery","etsy.listings-feed","etsy.lazyload"],function(t,e){t(".lazy").appear(function(){t(this).find("img[data-src]").lazyLoad()});var i=i||{};return i.initFeedPage=function(t,i){e.isBrowse=!0,t.root=t.root||"/browse/",e.init(t,i)},i});